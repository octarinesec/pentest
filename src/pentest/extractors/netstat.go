package extractors

import (
	"github.com/drael/GOnetstat"
	"os"
	"pentest/engine"
)

type NetstatExtractor struct{}

func (NetstatExtractor) Extract() {
	engine.Logger.Debugf("Extracting targets from netstat")

	details := GOnetstat.Tcp()
	for _, process := range details {
		engine.AddIP(process.Ip)
		engine.AddPort(uint16(process.ForeignPort))
	}
}

func init() {
	engine.Logger.Debugf("Adding NetstatExtractor Extractor")

	file, err := os.Open("/proc")
	if err != nil {
		engine.Logger.Debugf("Netstat isn't supported. error opening /proc: %v", err)
		return
	}
	file.Close()

	engine.AddExtractor(NetstatExtractor{})
}
