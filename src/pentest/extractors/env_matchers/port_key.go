package env_matchers

import (
	"log"
	"pentest/engine"
	"strconv"
	"strings"
)

type PortKeyMatcher struct {}

func ParsePortFromString(val string) (uint16, error) {
	converted, err := strconv.ParseUint(val, 10, 16)
	if err == nil {
		return uint16(converted), nil
	} else {
		return 0, err
	}

}

func (PortKeyMatcher) Match(key, val string) () {
	if strings.Contains(strings.ToLower(key), "port") {
		if port, err := ParsePortFromString(val); err == nil {
			engine.AddPort(port)
		} else {
			log.Printf("port %v isn't number somehow: %v. skipping.\n", val, err)
		}
	}
}

func init () {
	log.Println("Loading Environment Port Key Matcher")
	AddMatcher(PortKeyMatcher{})
}
