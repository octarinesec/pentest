package testers

import (
	"fmt"
	"log"
	"net/http"
	"pentest/engine"
)

type SwaggerTester struct{}

func testByUrl(url string) bool {
	resp, err := http.Get(url)
	if err != nil {
		return false
	}
	defer resp.Body.Close()

	return resp.StatusCode == http.StatusOK
}


func (SwaggerTester) Test(target engine.Target) {
	protocols := []string{"http", "https"}
	paths := []string{"", "v1/", "v2/", "v3/", "v4/"}


	for _, protocol := range protocols {
		for _, path := range paths {
			url := fmt.Sprintf("%s://%s:%d/%sswagger.json", protocol, target.IP, target.Port, path)
			if testByUrl(url) {
				log.Printf("Found swagger on %s!\n", url)
			}
		}
	}
}

func init() {
	log.Println("Loading Swagger Tester")

	engine.AddTester(SwaggerTester{})
}
